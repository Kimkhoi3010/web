migration:
  options:
    install_command: odoo
  versions:
    - version: 10.0.0
      operations:
        pre:
          # ***********************************************************
          # ************* Avoid auto-install chart of accounts ********
          # ***********************************************************
          - anthem songs.install.pre::main
          # Install account without l10n to avoid auto install
          - odoo -i account --stop-after-init --workers=0
          - anthem songs.install.accounting::no_coa_instance_lock
        post:
          - anthem songs.install.accounting::no_coa_instance_unlock
          - anthem songs.install.pre::setup_company
          - anthem openerp.addons.cloud_platform.songs::install_exoscale
          - anthem songs.install.setup::main
          - anthem songs.install.data::main
          - anthem songs.install.accounting::main
          - anthem songs.install.company::main
          - anthem songs.install.rights::main
      modes:
        full:
          operations:
            post:
              - anthem songs.install.accounting::configure_missing_chart_of_account
      addons:
        upgrade:
          - base_technical_features
          - mail_environment
          - server_environment
          #### core
          - account
          - account_cancel
          - account_tax_cash_basis
          - auth_oauth
          - board
          - crm
          - inter_company_rules
          - l10n_be
          - l10n_ch
          - l10n_fr
          - l10n_lu
          - l10n_mx
          - marketing_campaign
          - purchase
          - sale
          - subscription
          - survey
          - web
          #### OCA
          - account_bank_statement_import_ofx
          - account_banking_sepa_credit_transfer
          - account_financial_report_qweb
          - account_fiscal_year
          - account_move_locking
          - account_yodlee
          - base_phone
          - l10n_fr_siret
          - partner_changeset
          - partner_firstname
          - partner_survey
          - sale_automatic_workflow
          - sale_automatic_workflow_payment_mode
          - web_duplicate_visibility
          #### camptocamp/cloud-platform
          - attachment_s3
          - cloud_platform
          #### local-src
          - fields_regex_validation
          - report_page_endnote
          - sale_discount_program
          - specific_account
          - specific_base
          - specific_discount_program
          - specific_security
          - specific_payment_mode
    - version: 10.1.0
      operations:
        pre:
          - anthem songs.updates.update_10_1_0.update::main
          - odoo -i account_payment_term_extension,specific_base,specific_security --stop-after-init --workers=0
          # These 2 scripts must be executed after install of previous module
          - anthem songs.install.rights::setup_export_rights
          - anthem songs.updates.update_10_1_0.update::unlink_depiltech_payment_modes
        post:
          - anthem songs.updates.update_10_1_0.post_update::main
      addons:
        upgrade:
          #### core
          - base  # Because we updated all repositories
          #### OCA/account-invoicing
          - account_payment_term_extension
          #### OCA/bank-payment
          - account_payment_order
          #### local-src
          - discount_program_report
          - report_invoice
          - sale_discount_program
          - sale_tax_calculation
          - specific_base
          - specific_discount_program
          - specific_export_manager
          - specific_payment_mode
          - specific_sale_order
          - specific_security
    - version: 10.1.1
      operations:
        pre:
          - anthem songs.updates.update_10_1_1.pre_update::main
          - psql -f /opt/odoo/songs/updates/update_10_1_1/clean_translation.sql
        post:
          - anthem songs.updates.update_10_1_1.sale_workflow_settings::main
      addons:
        upgrade:
          #### local-src
          - report_invoice
          - sale_discount_program
          - specific_base
          - specific_discount_program
          - specific_payment_mode
    - version: 10.1.2
      operations:
        pre:
          - psql -f /opt/odoo/songs/updates/update_10_1_2/update.sql
        post:
          - anthem songs.install.rights::setup_export_rights
          - anthem songs.updates.update_10_1_2.update::main
          # Update sale_discount_program after anthem script to set
          # sale.discount.program field type as required
          - odoo -u sale_discount_program --stop-after-init --workers=0
      addons:
        upgrade:
          #### local-src
          - specific_base
          - specific_payment_mode
          - specific_security
          - sale_discount_program
          - specific_discount_program
          - discount_program_report
    - version: 10.2.0
      operations:
        pre:
          - psql -f /opt/odoo/songs/updates/update_10_2_0/update.sql
      addons:
        upgrade:
          #### local-src
          - discount_program_report
          - fields_regex_validation
          - report_invoice
          - report_page_endnote
          - sale_discount_program
          - specific_base
          - specific_discount_program
          - specific_export_manager
          - specific_payment_mode
          - specific_sale_order
          - specific_security
          ## server-tools (updated whole repo)
          - base_export_manager
          - base_report_auto_create_qweb
          - base_technical_features
          - date_range
          - mail_environment
          - server_environment
          ## odoo-prototype
          - base_dj
