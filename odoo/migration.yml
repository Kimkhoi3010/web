migration:
  options:
    install_command: odoo
  versions:
    - version: 10.0.0
      operations:
        pre:
          # ***********************************************************
          # ************* Avoid auto-install chart of accounts ********
          # ***********************************************************
          - anthem songs.install.pre::main
          # Install account without l10n to avoid auto install
          - odoo -i account --stop-after-init --workers=0
          - anthem songs.install.accounting::no_coa_instance_lock
        post:
          - anthem songs.install.accounting::no_coa_instance_unlock
          - anthem songs.install.pre::setup_company
          - anthem openerp.addons.cloud_platform.songs::install_exoscale
          - anthem songs.install.setup::main
          - anthem songs.install.data::main
          - anthem songs.install.accounting::main
          - anthem songs.install.company::main
          - anthem songs.install.rights::main
      modes:
        full:
          operations:
            post:
              - anthem songs.install.accounting::configure_missing_chart_of_account
      addons:
        upgrade:
          - base_technical_features
          - mail_environment
          - server_environment
          #### core
          - account
          - account_cancel
          - account_tax_cash_basis
          - auth_oauth
          - board
          - crm
          - inter_company_rules
          - l10n_be
          - l10n_ch
          - l10n_fr
          - l10n_lu
          - l10n_mx
          - marketing_campaign
          - purchase
          - sale
          - subscription
          - survey
          - web
          #### OCA
          - account_bank_statement_import_ofx
          - account_banking_sepa_credit_transfer
          - account_financial_report_qweb
          - account_fiscal_year
          - account_move_locking
          - account_yodlee
          - base_phone
          - l10n_fr_siret
          - partner_changeset
          - partner_firstname
          - partner_survey
          - sale_automatic_workflow
          - sale_automatic_workflow_payment_mode
          - web_duplicate_visibility
          #### camptocamp/cloud-platform
          - attachment_s3
          - cloud_platform
          #### local-src
          - fields_regex_validation
          - report_page_endnote
          - sale_discount_program
          - specific_account
          - specific_base
          - specific_discount_program
          - specific_payment_mode
    # For migration fix, we don't increment version number here.
    # But only in VERSION and HISTORY.rst files.
    # The integration database must be deleted for each deployment.
    - version: 10.1.0
      addons:
        upgrade:
          #### local-src
          - report_invoice
          - sale_tax_calculation
          - specific_base
